{"version":3,"file":"templateStore-COSm-G0G.js","sources":["../../src/stores/memory.ts","../../src/api/direct-api-service.ts","../../src/composables/useTaskStop.ts","../../src/stores/task.ts","../../src/stores/sidebar.ts","../../src/api/plan-act-api-service.ts","../../src/composables/usePlanTemplateConfig.ts","../../src/stores/templateStore.ts"],"sourcesContent":["/*\n * Copyright 2024-2026 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { reactive } from 'vue'\n\nexport interface MemoryEmits {\n  (e: 'memory-selected'): void\n}\n\nexport class MemoryStore {\n  // Basic state\n  isCollapsed = false\n  conversationId: string | null = null\n  loadMessages = () => {}\n  intervalId: number | undefined = undefined\n\n  // LocalStorage key for persisting conversationId\n  private readonly CONVERSATION_ID_KEY = 'currentConversationId'\n\n  constructor() {\n    // Load conversation ID from localStorage on initialization\n    this.loadConversationIdFromStorage()\n  }\n\n  /**\n   * Load conversation ID from localStorage\n   */\n  private loadConversationIdFromStorage() {\n    try {\n      const savedConversationId = localStorage.getItem(this.CONVERSATION_ID_KEY)\n      if (savedConversationId) {\n        this.conversationId = savedConversationId\n        console.log('[MemoryStore] Restored conversationId from localStorage:', savedConversationId)\n      }\n    } catch (error) {\n      console.warn('[MemoryStore] Failed to load conversationId from localStorage:', error)\n    }\n  }\n\n  /**\n   * Save conversation ID to localStorage\n   */\n  private saveConversationIdToStorage() {\n    try {\n      if (this.conversationId) {\n        localStorage.setItem(this.CONVERSATION_ID_KEY, this.conversationId)\n        console.log('[MemoryStore] Saved conversationId to localStorage:', this.conversationId)\n      } else {\n        localStorage.removeItem(this.CONVERSATION_ID_KEY)\n        console.log('[MemoryStore] Removed conversationId from localStorage')\n      }\n    } catch (error) {\n      console.warn('[MemoryStore] Failed to save conversationId to localStorage:', error)\n    }\n  }\n\n  toggleSidebar() {\n    this.isCollapsed = !this.isCollapsed\n    if (this.isCollapsed) {\n      this.loadMessages()\n      this.intervalId = window.setInterval(() => {\n        this.loadMessages()\n      }, 3000)\n    } else {\n      clearInterval(this.intervalId)\n    }\n  }\n\n  /**\n   * Select a conversation (replaces selectMemory)\n   * @param conversationId The conversation ID to select\n   */\n  selectConversation(conversationId: string) {\n    this.toggleSidebar()\n    this.conversationId = conversationId\n    this.saveConversationIdToStorage()\n  }\n\n  /**\n   * Clear the selected conversation (replaces clearMemoryId)\n   */\n  clearSelectedConversation() {\n    this.conversationId = null\n    this.saveConversationIdToStorage()\n  }\n\n  setConversationId(conversationId: string | null) {\n    this.conversationId = conversationId\n    // Persist to localStorage whenever conversationId changes\n    this.saveConversationIdToStorage()\n  }\n\n  clearConversationId() {\n    this.conversationId = null\n    // Clear from localStorage\n    this.saveConversationIdToStorage()\n  }\n\n  /**\n   * Get the current conversation ID (from memory or localStorage)\n   */\n  getConversationId(): string | null {\n    return this.conversationId\n  }\n\n  generateRandomId(): string {\n    return Math.random().toString(36).substring(2, 10)\n  }\n\n  setLoadMessages(messages: () => void) {\n    this.loadMessages = messages\n  }\n}\n\nexport const memoryStore = reactive(new MemoryStore())\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { InputMessage } from '@/types/message-dialog'\nimport { memoryStore } from '@/stores/memory'\nimport { LlmCheckService } from '@/utils/llm-check'\n\nexport class DirectApiService {\n  private static readonly BASE_URL = '/api/executor'\n\n  // Send task directly (direct execution mode)\n  public static async sendMessage(query: InputMessage): Promise<unknown> {\n    return LlmCheckService.withLlmCheck(async () => {\n      // Add requestSource to distinguish from HTTP requests\n      const requestBody = {\n        ...query,\n        requestSource: 'VUE_DIALOG',\n      }\n\n      const response = await fetch(`${this.BASE_URL}/execute`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(requestBody),\n      })\n      if (!response.ok) throw new Error(`API request failed: ${response.status}`)\n      return await response.json()\n    })\n  }\n\n  // Send simple chat message with SSE streaming (no plan execution, just LLM chat)\n  public static async sendChatMessage(\n    query: InputMessage,\n    requestSource: 'VUE_DIALOG' | 'VUE_SIDEBAR' = 'VUE_DIALOG',\n    onChunk?: (chunk: {\n      type: string\n      content?: string\n      conversationId?: string\n      message?: string\n    }) => void\n  ): Promise<{ conversationId?: string; message?: string }> {\n    return LlmCheckService.withLlmCheck(async () => {\n      console.log('[DirectApiService] sendChatMessage called with:', {\n        input: query.input,\n        uploadedFiles: query.uploadedFiles,\n        uploadKey: query.uploadKey,\n        requestSource,\n      })\n\n      const requestBody: Record<string, unknown> = {\n        input: query.input,\n        requestSource: requestSource,\n      }\n\n      // Include conversationId from memoryStore if available\n      if (memoryStore.conversationId) {\n        requestBody.conversationId = memoryStore.conversationId\n        console.log(\n          '[DirectApiService] Including conversationId from memoryStore:',\n          memoryStore.conversationId\n        )\n      }\n\n      // Include uploaded files if present\n      if (query.uploadedFiles && query.uploadedFiles.length > 0) {\n        requestBody.uploadedFiles = query.uploadedFiles\n        console.log('[DirectApiService] Including uploaded files:', query.uploadedFiles.length)\n      }\n\n      // Include uploadKey if present\n      if (query.uploadKey) {\n        requestBody.uploadKey = query.uploadKey\n        console.log('[DirectApiService] Including uploadKey:', query.uploadKey)\n      }\n\n      console.log('[DirectApiService] Making SSE request to:', `${this.BASE_URL}/chat`)\n      console.log('[DirectApiService] Request body:', requestBody)\n\n      const response = await fetch(`${this.BASE_URL}/chat`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'text/event-stream',\n        },\n        body: JSON.stringify(requestBody),\n      })\n\n      console.log('[DirectApiService] Response status:', response.status, response.ok)\n      console.log('[DirectApiService] Response headers:', {\n        contentType: response.headers.get('Content-Type'),\n        transferEncoding: response.headers.get('Transfer-Encoding'),\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[DirectApiService] Request failed:', errorText)\n        throw new Error(`Failed to send chat message: ${response.status}`)\n      }\n\n      // Handle SSE streaming\n      if (!response.body) {\n        throw new Error('Response body is null')\n      }\n\n      const reader = response.body.getReader()\n      const decoder = new TextDecoder()\n      let buffer = ''\n      let conversationId: string | undefined\n      let accumulatedMessage = ''\n\n      console.log('[DirectApiService] Starting to read SSE stream...')\n\n      try {\n        while (true) {\n          const { done, value } = await reader.read()\n          console.log('[DirectApiService] Read chunk:', { done, valueLength: value?.length })\n          if (done) break\n\n          buffer += decoder.decode(value, { stream: true })\n          console.log(\n            '[DirectApiService] Buffer length:',\n            buffer.length,\n            'content:',\n            buffer.substring(0, 200)\n          )\n          const lines = buffer.split('\\n\\n')\n          buffer = lines.pop() || '' // Keep incomplete line in buffer\n          console.log(\n            '[DirectApiService] Split into',\n            lines.length,\n            'lines, buffer remaining:',\n            buffer.length\n          )\n\n          for (const line of lines) {\n            console.log('[DirectApiService] Processing line:', line)\n            if (line.startsWith('data:')) {\n              // Handle both 'data:' and 'data: ' formats\n              const data = line.startsWith('data: ') ? line.slice(6) : line.slice(5)\n              console.log('[DirectApiService] Extracted data:', data)\n              try {\n                const parsed = JSON.parse(data) as {\n                  type: string\n                  content?: string\n                  conversationId?: string\n                  message?: string\n                }\n                console.log('[DirectApiService] Parsed SSE event:', parsed)\n\n                if (parsed.type === 'start' && parsed.conversationId) {\n                  conversationId = parsed.conversationId\n                  console.log(\n                    '[DirectApiService] Got start event with conversationId:',\n                    conversationId\n                  )\n                  if (onChunk) {\n                    onChunk({ type: 'start', conversationId: parsed.conversationId })\n                  }\n                } else if (parsed.type === 'chunk' && parsed.content) {\n                  accumulatedMessage += parsed.content\n                  console.log(\n                    '[DirectApiService] Got chunk, accumulated length:',\n                    accumulatedMessage.length\n                  )\n                  if (onChunk) {\n                    onChunk({ type: 'chunk', content: parsed.content })\n                  }\n                } else if (parsed.type === 'done') {\n                  console.log('[DirectApiService] Got done event')\n                  if (onChunk) {\n                    onChunk({ type: 'done' })\n                  }\n                } else if (parsed.type === 'error') {\n                  console.error('[DirectApiService] Got error event:', parsed.message)\n                  if (onChunk) {\n                    onChunk({\n                      type: 'error',\n                      message: parsed.message || 'Streaming error occurred',\n                    })\n                  }\n                  // Break the loop to stop processing\n                  reader.releaseLock()\n                  throw new Error(parsed.message || 'Streaming error occurred')\n                }\n              } catch (parseError) {\n                console.error(\n                  '[DirectApiService] Error parsing SSE data:',\n                  parseError,\n                  'Data:',\n                  data\n                )\n              }\n            }\n          }\n        }\n      } finally {\n        reader.releaseLock()\n      }\n\n      const result: { conversationId?: string; message?: string } = {}\n      if (conversationId) {\n        result.conversationId = conversationId\n      }\n      result.message = accumulatedMessage || 'No response received'\n      console.log('[DirectApiService] sendChatMessage completed:', result)\n      return result\n    })\n  }\n\n  // Unified method to execute by tool name (replaces both sendMessageWithDefaultPlan and PlanActApiService.executePlan)\n  public static async executeByToolName(\n    toolName: string,\n    replacementParams?: Record<string, string>,\n    uploadedFiles?: string[],\n    uploadKey?: string,\n    requestSource: 'VUE_DIALOG' | 'VUE_SIDEBAR' = 'VUE_DIALOG',\n    serviceGroup?: string\n  ): Promise<unknown> {\n    return LlmCheckService.withLlmCheck(async () => {\n      console.log('[DirectApiService] executeByToolName called with:', {\n        toolName,\n        replacementParams,\n        uploadedFiles,\n        uploadKey,\n        requestSource,\n        serviceGroup,\n      })\n\n      const requestBody: Record<string, unknown> = {\n        toolName: toolName,\n        requestSource: requestSource,\n      }\n\n      // Include conversationId from memoryStore if available\n      if (memoryStore.conversationId) {\n        requestBody.conversationId = memoryStore.conversationId\n        console.log(\n          '[DirectApiService] Including conversationId from memoryStore:',\n          memoryStore.conversationId\n        )\n      }\n\n      // Include serviceGroup if provided\n      if (serviceGroup) {\n        requestBody.serviceGroup = serviceGroup\n        console.log('[DirectApiService] Including serviceGroup:', serviceGroup)\n      }\n\n      // Include replacement parameters if present\n      if (replacementParams && Object.keys(replacementParams).length > 0) {\n        requestBody.replacementParams = replacementParams\n        console.log('[DirectApiService] Including replacement params:', replacementParams)\n      }\n\n      // Include uploaded files if present\n      if (uploadedFiles && uploadedFiles.length > 0) {\n        requestBody.uploadedFiles = uploadedFiles\n        console.log('[DirectApiService] Including uploaded files:', uploadedFiles.length)\n      }\n\n      // Include uploadKey if present\n      if (uploadKey) {\n        requestBody.uploadKey = uploadKey\n        console.log('[DirectApiService] Including uploadKey:', uploadKey)\n      }\n\n      console.log(\n        '[DirectApiService] Making request to:',\n        `${this.BASE_URL}/executeByToolNameAsync`\n      )\n      console.log('[DirectApiService] Request body:', requestBody)\n\n      const response = await fetch(`${this.BASE_URL}/executeByToolNameAsync`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(requestBody),\n      })\n\n      console.log('[DirectApiService] Response status:', response.status, response.ok)\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[DirectApiService] Request failed:', errorText)\n        throw new Error(`Failed to execute: ${response.status}`)\n      }\n\n      const result = await response.json()\n      console.log('[DirectApiService] executeByToolName response:', result)\n      return result\n    })\n  }\n\n  // Stop a running task by plan ID\n  public static async stopTask(planId: string): Promise<unknown> {\n    return LlmCheckService.withLlmCheck(async () => {\n      console.log('[DirectApiService] Stopping task for planId:', planId)\n\n      const response = await fetch(`${this.BASE_URL}/stopTask/${planId}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}))\n        throw new Error(errorData.error || `Failed to stop task: ${response.status}`)\n      }\n\n      return await response.json()\n    })\n  }\n}\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DirectApiService } from '@/api/direct-api-service'\nimport { useTaskStore } from '@/stores/task'\nimport { ref, computed } from 'vue'\n\n/**\n * Composable for handling task stop functionality\n * Provides reusable stop logic for components that need to stop running tasks\n */\nexport function useTaskStop() {\n  const taskStore = useTaskStore()\n  const isStopping = ref(false)\n\n  /**\n   * Check if there's a running task that can be stopped\n   */\n  const canStop = computed(() => {\n    return taskStore.hasRunningTask() && !!taskStore.currentTask?.planId\n  })\n\n  /**\n   * Stop a running task by plan ID\n   * @param planId Plan ID to stop. If not provided, uses planId from currentTask\n   * @param updateTaskState Whether to update taskStore state after stopping (default: true)\n   * @returns Promise<boolean> - true if stop was successful, false otherwise\n   */\n  const stopTask = async (planId?: string, updateTaskState: boolean = true): Promise<boolean> => {\n    // Determine which planId to use\n    const targetPlanId = planId || taskStore.currentTask?.planId\n\n    if (!targetPlanId) {\n      console.warn('[useTaskStop] No planId available to stop')\n      return false\n    }\n\n    if (isStopping.value) {\n      console.log('[useTaskStop] Stop already in progress, skipping')\n      return false\n    }\n\n    console.log('[useTaskStop] Stopping task for planId:', targetPlanId)\n    isStopping.value = true\n\n    try {\n      await DirectApiService.stopTask(targetPlanId)\n      console.log('[useTaskStop] Task stopped successfully')\n\n      // Update task state if requested and it matches the stopped planId\n      if (\n        updateTaskState &&\n        taskStore.currentTask &&\n        taskStore.currentTask.planId === targetPlanId\n      ) {\n        taskStore.currentTask.isRunning = false\n      }\n\n      return true\n    } catch (error) {\n      console.error('[useTaskStop] Failed to stop task:', error)\n      return false\n    } finally {\n      isStopping.value = false\n    }\n  }\n\n  return {\n    stopTask,\n    isStopping,\n    canStop,\n  }\n}\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { defineStore } from 'pinia'\nimport { ref } from 'vue'\nimport { useTaskStop } from '@/composables/useTaskStop'\n\nexport interface TaskPayload {\n  prompt: string\n  timestamp: number\n  processed?: boolean\n  planId?: string\n  isRunning?: boolean\n}\n\nexport const useTaskStore = defineStore('task', () => {\n  const currentTask = ref<TaskPayload | null>(null)\n  const taskToInput = ref<string>('')\n  const hasVisitedHome = ref(false)\n\n  // Set new task\n  const setTask = (prompt: string) => {\n    console.log('[TaskStore] setTask called with prompt:', prompt)\n\n    // Don't create tasks with empty prompts\n    if (!prompt.trim()) {\n      console.warn('[TaskStore] Empty prompt provided, not creating task')\n      return\n    }\n\n    const newTask = {\n      prompt,\n      timestamp: Date.now(),\n      processed: false,\n    }\n    currentTask.value = newTask\n    console.log('[TaskStore] Task set, currentTask.value:', currentTask.value)\n  }\n\n  // Set task to input (for pre-filling input without executing)\n  const setTaskToInput = (prompt: string) => {\n    console.log('[TaskStore] setTaskToInput called with prompt:', prompt)\n    taskToInput.value = prompt\n    console.log('[TaskStore] Task to input set:', taskToInput.value)\n  }\n\n  // Get and clear task to input\n  const getAndClearTaskToInput = () => {\n    const task = taskToInput.value\n    taskToInput.value = ''\n    console.log('[TaskStore] getAndClearTaskToInput returning:', task)\n    return task\n  }\n\n  // Mark task as processed\n  const markTaskAsProcessed = () => {\n    console.log('[TaskStore] markTaskAsProcessed called, current task:', currentTask.value)\n    if (currentTask.value) {\n      currentTask.value.processed = true\n      console.log('[TaskStore] Task marked as processed:', currentTask.value)\n    } else {\n      console.log('[TaskStore] No current task to mark as processed')\n    }\n  }\n\n  // Clear task\n  const clearTask = () => {\n    currentTask.value = null\n  }\n\n  // Check if there are unprocessed tasks\n  const hasUnprocessedTask = () => {\n    const result = currentTask.value && !currentTask.value.processed\n    console.log(\n      '[TaskStore] hasUnprocessedTask check - currentTask:',\n      currentTask.value,\n      'result:',\n      result\n    )\n    return result\n  }\n\n  // Set that home page has been visited\n  const markHomeVisited = () => {\n    hasVisitedHome.value = true\n    // Save to localStorage\n    localStorage.setItem('hasVisitedHome', 'true')\n  }\n\n  // Check if home page has been visited\n  const checkHomeVisited = () => {\n    const stored = localStorage.getItem('hasVisitedHome')\n    hasVisitedHome.value = stored === 'true'\n    return hasVisitedHome.value\n  }\n\n  // Reset visit status (for debugging or reset)\n  const resetHomeVisited = () => {\n    hasVisitedHome.value = false\n    localStorage.removeItem('hasVisitedHome')\n  }\n\n  // Emit plan execution requested event\n  const emitPlanExecutionRequested = (payload: {\n    title: string\n    planData: unknown\n    params?: string\n  }) => {\n    console.log('[TaskStore] emitPlanExecutionRequested called with payload:', payload)\n\n    // User is on direct page, send event directly\n    window.dispatchEvent(new CustomEvent('plan-execution-requested', { detail: payload }))\n  }\n\n  // Set task as running with plan ID\n  const setTaskRunning = (planId: string) => {\n    console.log('[TaskStore] setTaskRunning called with planId:', planId)\n    // Create a task if none exists, or update existing one\n    if (!currentTask.value) {\n      // Create a new task for running state\n      currentTask.value = {\n        prompt: '', // Empty prompt since this is just for tracking running state\n        timestamp: Date.now(),\n        processed: false,\n        planId: planId,\n        isRunning: true,\n      }\n      console.log('[TaskStore] Created new task for running state:', currentTask.value)\n    } else {\n      currentTask.value.planId = planId\n      currentTask.value.isRunning = true\n      console.log('[TaskStore] Updated existing task:', currentTask.value)\n    }\n  }\n\n  // Stop current running task\n  // Uses shared stop logic from useTaskStop composable\n  const stopCurrentTask = async () => {\n    console.log('[TaskStore] stopCurrentTask called')\n    if (currentTask.value && currentTask.value.isRunning && currentTask.value.planId) {\n      // Use shared stop logic from composable\n      const { stopTask } = useTaskStop()\n      return await stopTask(currentTask.value.planId, true)\n    }\n    return false\n  }\n\n  // Check if there's a running task\n  const hasRunningTask = () => {\n    const result = currentTask.value && currentTask.value.isRunning\n    console.log('[TaskStore] hasRunningTask check - result:', result)\n    return result\n  }\n\n  return {\n    currentTask,\n    taskToInput,\n    hasVisitedHome,\n    setTask,\n    setTaskToInput,\n    getAndClearTaskToInput,\n    markTaskAsProcessed,\n    clearTask,\n    hasUnprocessedTask,\n    markHomeVisited,\n    checkHomeVisited,\n    resetHomeVisited,\n    emitPlanExecutionRequested,\n    setTaskRunning,\n    stopCurrentTask,\n    hasRunningTask,\n  }\n})\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { reactive } from 'vue'\n\ntype TabType = 'list'\n\nexport class SidebarStore {\n  // Basic state (sidebar UI state only)\n  isCollapsed = false\n  currentTab: TabType = 'list'\n\n  // Actions\n  toggleSidebar() {\n    this.isCollapsed = !this.isCollapsed\n  }\n\n  switchToTab(tab: TabType) {\n    this.currentTab = tab\n  }\n}\n\nexport const sidebarStore = reactive(new SidebarStore())\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Plan-related API wrapper (TypeScript version for Vue projects)\n\nimport { DirectApiService } from '@/api/direct-api-service'\nimport { LlmCheckService } from '@/utils/llm-check'\n\nexport class PlanActApiService {\n  private static readonly PLAN_TEMPLATE_URL = '/api/plan-template'\n\n  // Execute generated plan using LynxeController.executeByToolNameAsync\n  public static async executePlan(\n    toolName: string,\n    serviceGroup: string | undefined,\n    rawParam?: string,\n    uploadedFiles?: string[],\n    replacementParams?: Record<string, string>,\n    uploadKey?: string,\n    requestSource: 'VUE_DIALOG' | 'VUE_SIDEBAR' = 'VUE_SIDEBAR'\n  ): Promise<unknown> {\n    return LlmCheckService.withLlmCheck(async () => {\n      console.log('[PlanActApiService] executePlan called with:', {\n        toolName,\n        serviceGroup,\n        rawParam,\n        uploadedFiles,\n        replacementParams,\n        uploadKey,\n        requestSource,\n      })\n\n      // Add rawParam to replacementParams if provided (backend expects it in replacementParams)\n      if (rawParam) {\n        if (!replacementParams) {\n          replacementParams = {}\n        }\n        replacementParams['userRequirement'] = rawParam\n        console.log('[PlanActApiService] Added rawParam to replacementParams:', rawParam)\n      }\n\n      // Use the unified DirectApiService method (default to VUE_SIDEBAR for plan execution)\n      return await DirectApiService.executeByToolName(\n        toolName,\n        replacementParams,\n        uploadedFiles,\n        uploadKey,\n        requestSource,\n        serviceGroup\n      )\n    })\n  }\n\n  // Get all versions of plan\n  public static async getPlanVersions(planId: string): Promise<unknown> {\n    const response = await fetch(`${this.PLAN_TEMPLATE_URL}/versions`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ planId }),\n    })\n    if (!response.ok) throw new Error(`Failed to get plan versions: ${response.status}`)\n    return await response.json()\n  }\n\n  // Get all plan template list\n  public static async getAllPlanTemplates(): Promise<unknown> {\n    const response = await fetch(`${this.PLAN_TEMPLATE_URL}/list`)\n    if (!response.ok) throw new Error(`Failed to get plan template list: ${response.status}`)\n    return await response.json()\n  }\n}\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PlanActApiService } from '@/api/plan-act-api-service'\nimport { PlanTemplateApiService } from '@/api/plan-template-with-tool-api-service'\nimport type {\n  InputSchemaParam,\n  PlanTemplateConfigVO,\n  StepConfig,\n  ToolConfigVO,\n} from '@/types/plan-template'\nimport { computed, reactive, ref } from 'vue'\n\n/**\n * Composable for managing PlanTemplateConfigVO\n * Provides getter and setter methods for all properties\n */\nexport function usePlanTemplateConfig() {\n  // Reactive state for PlanTemplateConfigVO\n  const config = reactive<PlanTemplateConfigVO>({\n    title: '',\n    steps: [],\n    planType: 'dynamic_agent',\n    planTemplateId: '',\n    accessLevel: 'editable',\n    serviceGroup: '',\n  })\n\n  // Loading state\n  const isLoading = ref(false)\n  const error = ref<string | null>(null)\n\n  // Flag to prevent watchers from syncing when user is updating individual properties\n  const isUserUpdating = ref(false)\n\n  // Flag to indicate that a full refresh is needed (for load, setConfig, fromJsonString, reset, version control)\n  const needsFullRefresh = ref(false)\n\n  // Version control state\n  const planVersions = ref<string[]>([])\n  const currentVersionIndex = ref(-1)\n\n  // Template list and selection state\n  const planTemplateList = ref<PlanTemplateConfigVO[]>([])\n  const selectedTemplate = ref<PlanTemplateConfigVO | null>(null)\n  const currentPlanTemplateId = ref<string | null>(null)\n\n  // Getters\n  const getTitle = () => config.title\n  const getPlanType = () => config.planType || 'dynamic_agent'\n  const getServiceGroup = () => config.serviceGroup || ''\n\n  // Setters\n  const setTitle = (title: string) => {\n    config.title = title\n  }\n\n  const setSteps = (steps: StepConfig[]) => {\n    config.steps = steps || []\n  }\n\n  const setPlanType = (planType: string) => {\n    config.planType = planType\n  }\n\n  const setPlanTemplateId = (planTemplateId: string) => {\n    config.planTemplateId = planTemplateId\n  }\n\n  const setServiceGroup = (serviceGroup: string) => {\n    config.serviceGroup = serviceGroup\n  }\n\n  const setToolConfig = (toolConfig: ToolConfigVO | undefined) => {\n    if (toolConfig === undefined) {\n      delete config.toolConfig\n    } else {\n      config.toolConfig = toolConfig\n    }\n  }\n\n  // ToolConfig getters (no getters are used, only setters)\n\n  // ToolConfig setters\n  const setToolDescription = (toolDescription: string) => {\n    if (!config.toolConfig) {\n      config.toolConfig = {}\n    }\n    config.toolConfig.toolDescription = toolDescription\n  }\n\n  const setEnableInternalToolcall = (enable: boolean) => {\n    if (!config.toolConfig) {\n      config.toolConfig = {}\n    }\n    config.toolConfig.enableInternalToolcall = enable\n  }\n\n  const setEnableHttpService = (enable: boolean) => {\n    if (!config.toolConfig) {\n      config.toolConfig = {}\n    }\n    config.toolConfig.enableHttpService = enable\n  }\n\n  const setEnableInConversation = (enable: boolean) => {\n    if (!config.toolConfig) {\n      config.toolConfig = {}\n    }\n    config.toolConfig.enableInConversation = enable\n  }\n\n  const setInputSchema = (inputSchema: InputSchemaParam[]) => {\n    if (!config.toolConfig) {\n      config.toolConfig = {}\n    }\n    config.toolConfig.inputSchema = inputSchema || []\n  }\n\n  // Get full config\n  const getConfig = (): PlanTemplateConfigVO => {\n    return { ...config }\n  }\n\n  // Set full config\n  const setConfig = (newConfig: PlanTemplateConfigVO) => {\n    needsFullRefresh.value = true\n    // Get accessLevel with backward compatibility for readOnly\n    const accessLevel = newConfig.accessLevel || (newConfig.readOnly ? 'readOnly' : 'editable')\n    const updatedConfig: PlanTemplateConfigVO = {\n      title: newConfig.title || '',\n      // Deep copy steps to preserve all properties including selectedToolKeys\n      // Convert null selectedToolKeys to empty array for consistency\n      steps: (newConfig.steps || []).map(step => ({\n        ...step,\n        selectedToolKeys: step.selectedToolKeys ?? [],\n      })),\n      planType: newConfig.planType || 'dynamic_agent',\n      planTemplateId: newConfig.planTemplateId || '',\n      accessLevel: accessLevel,\n      serviceGroup: newConfig.serviceGroup || '',\n    }\n    if (newConfig.toolConfig) {\n      updatedConfig.toolConfig = { ...newConfig.toolConfig }\n    }\n    Object.assign(config, updatedConfig)\n    // Reset flag after reactivity update\n    // Use a longer delay to ensure watchers have time to process the change\n    setTimeout(() => {\n      needsFullRefresh.value = false\n    }, 50)\n  }\n\n  // Reset to default\n  const reset = () => {\n    needsFullRefresh.value = true\n    Object.assign(config, {\n      title: '',\n      steps: [],\n      planType: 'dynamic_agent',\n      planTemplateId: '',\n      accessLevel: 'editable',\n      serviceGroup: '',\n    })\n    // Remove toolConfig if it exists\n    if ('toolConfig' in config) {\n      delete config.toolConfig\n    }\n    planVersions.value = []\n    currentVersionIndex.value = -1\n    error.value = null\n    // Reset flag after reactivity update\n    setTimeout(() => {\n      needsFullRefresh.value = false\n    }, 0)\n  }\n\n  // Dynamically generate JSON from current config state (not cached, regenerated each time)\n  const generateJsonString = (): string => {\n    // Generate fresh JSON from current config state\n    // Ensure selectedToolKeys is always an array (not null) in the output\n    const accessLevel = config.accessLevel || (config.readOnly ? 'readOnly' : 'editable')\n    const jsonConfig: PlanTemplateConfigVO = {\n      title: config.title || '',\n      steps: (config.steps || []).map(step => ({\n        ...step,\n        // Ensure selectedToolKeys is always an array, not null\n        selectedToolKeys: step.selectedToolKeys ?? [],\n      })),\n      planType: config.planType || 'dynamic_agent',\n      planTemplateId: config.planTemplateId || '',\n      accessLevel: accessLevel,\n      serviceGroup: config.serviceGroup || '',\n    }\n    // Include toolConfig if it exists\n    if (config.toolConfig) {\n      jsonConfig.toolConfig = { ...config.toolConfig }\n    }\n    return JSON.stringify(jsonConfig, null, 2)\n  }\n\n  // Load config from JSON string\n  const fromJsonString = (jsonString: string) => {\n    try {\n      const parsed = JSON.parse(jsonString)\n      setConfig(parsed)\n      return true\n    } catch (err) {\n      error.value = err instanceof Error ? err.message : 'Invalid JSON format'\n      return false\n    }\n  }\n\n  // Version control methods\n  const canRollback = computed(() => {\n    return planVersions.value.length > 1 && currentVersionIndex.value > 0\n  })\n\n  const canRestore = computed(() => {\n    return (\n      planVersions.value.length > 1 && currentVersionIndex.value < planVersions.value.length - 1\n    )\n  })\n\n  const rollbackVersion = () => {\n    if (canRollback.value && currentVersionIndex.value > 0) {\n      currentVersionIndex.value--\n      const versionContent = planVersions.value[currentVersionIndex.value] || ''\n      fromJsonString(versionContent)\n    }\n  }\n\n  const restoreVersion = () => {\n    if (canRestore.value && currentVersionIndex.value < planVersions.value.length - 1) {\n      currentVersionIndex.value++\n      const versionContent = planVersions.value[currentVersionIndex.value] || ''\n      fromJsonString(versionContent)\n    }\n  }\n\n  // Update versions after save\n  const updateVersionsAfterSave = (content: string) => {\n    if (currentVersionIndex.value < planVersions.value.length - 1) {\n      planVersions.value = planVersions.value.slice(0, currentVersionIndex.value + 1)\n    }\n    planVersions.value.push(content)\n    currentVersionIndex.value = planVersions.value.length - 1\n  }\n\n  // Load from API\n  const load = async (planTemplateId: string) => {\n    if (!planTemplateId) {\n      error.value = 'Plan template ID is required'\n      return false\n    }\n\n    try {\n      isLoading.value = true\n      error.value = null\n\n      // Load config from API\n      const loadedConfig = await PlanTemplateApiService.getPlanTemplateConfigVO(planTemplateId)\n\n      // Check if this is the same template being reloaded\n      const isSameTemplate = currentPlanTemplateId.value === planTemplateId\n\n      // Update currentPlanTemplateId BEFORE setConfig to ensure watchers can detect the change\n      // If it's the same template, temporarily set to null first to trigger watch\n      if (isSameTemplate) {\n        currentPlanTemplateId.value = null\n        // Wait for the null assignment to be processed by watchers\n        await new Promise(resolve => setTimeout(resolve, 0))\n      }\n\n      // Ensure isUserUpdating is false before loading to allow sync\n      isUserUpdating.value = false\n\n      setConfig(loadedConfig)\n\n      // Update currentPlanTemplateId to ensure watchers can detect the change\n      currentPlanTemplateId.value = planTemplateId\n\n      // Force a small delay to ensure watchers have processed the changes\n      // This is especially important when reloading the same template\n      await new Promise(resolve => setTimeout(resolve, 10))\n\n      // Update selectedTemplate.value to keep it in sync with the loaded config\n      // This ensures RightPanel.vue uses the latest data from API, not stale data from template list\n      if (selectedTemplate.value?.planTemplateId === planTemplateId) {\n        selectedTemplate.value = {\n          ...selectedTemplate.value,\n          ...loadedConfig,\n        }\n      }\n\n      // Load versions for version control\n      try {\n        const versionsResponse = await PlanActApiService.getPlanVersions(planTemplateId)\n        planVersions.value = (versionsResponse as { versions?: string[] }).versions || []\n        if (planVersions.value.length > 0) {\n          currentVersionIndex.value = planVersions.value.length - 1\n        } else {\n          currentVersionIndex.value = -1\n        }\n      } catch (versionError) {\n        console.warn('Failed to load plan versions:', versionError)\n        planVersions.value = []\n        currentVersionIndex.value = -1\n      }\n\n      return true\n    } catch (err) {\n      error.value = err instanceof Error ? err.message : 'Failed to load plan template config'\n      console.error('Failed to load plan template config:', err)\n      return false\n    } finally {\n      isLoading.value = false\n    }\n  }\n\n  // Save to API\n  const save = async (): Promise<boolean> => {\n    if (!config.planTemplateId) {\n      error.value = 'Plan template ID is required'\n      return false\n    }\n\n    try {\n      isLoading.value = true\n      error.value = null\n\n      const result = await PlanTemplateApiService.createOrUpdatePlanTemplateWithTool(getConfig())\n\n      if (result.success) {\n        // Use the planTemplateId from backend response (may be different if frontend sent \"new-xxx\")\n        const actualPlanTemplateId = result.planTemplateId || config.planTemplateId\n\n        // Update local config with the actual planTemplateId from backend\n        if (actualPlanTemplateId && actualPlanTemplateId !== config.planTemplateId) {\n          console.log(\n            '[usePlanTemplateConfig] PlanTemplateId replaced by backend:',\n            config.planTemplateId,\n            '->',\n            actualPlanTemplateId\n          )\n          config.planTemplateId = actualPlanTemplateId\n        }\n\n        // Reload the template to get updated data from backend\n        if (actualPlanTemplateId) {\n          await load(actualPlanTemplateId)\n\n          // Update selectedTemplate if it matches the saved template\n          // Check both old and new planTemplateId to handle ID replacement\n          const oldPlanTemplateId = selectedTemplate.value?.planTemplateId\n          if (\n            oldPlanTemplateId === actualPlanTemplateId ||\n            oldPlanTemplateId === config.planTemplateId\n          ) {\n            const loadedConfig = getConfig()\n            selectedTemplate.value = {\n              ...selectedTemplate.value,\n              ...loadedConfig,\n              planTemplateId: actualPlanTemplateId, // Ensure using the actual ID\n            }\n          }\n\n          // Update planTemplateList if the template exists in the list\n          // Check both old and new planTemplateId\n          const templateIndex = planTemplateList.value.findIndex(\n            t => t.planTemplateId === actualPlanTemplateId || t.planTemplateId === oldPlanTemplateId\n          )\n          if (templateIndex >= 0) {\n            const loadedConfig = getConfig()\n            planTemplateList.value[templateIndex] = {\n              ...planTemplateList.value[templateIndex],\n              ...loadedConfig,\n              planTemplateId: actualPlanTemplateId, // Ensure using the actual ID\n            }\n          } else if (oldPlanTemplateId) {\n            // If template was not found in list but we have old ID, try to find and update it\n            const oldTemplateIndex = planTemplateList.value.findIndex(\n              t => t.planTemplateId === oldPlanTemplateId\n            )\n            if (oldTemplateIndex >= 0) {\n              const loadedConfig = getConfig()\n              planTemplateList.value[oldTemplateIndex] = {\n                ...planTemplateList.value[oldTemplateIndex],\n                ...loadedConfig,\n                planTemplateId: actualPlanTemplateId, // Update to new ID\n              }\n            }\n          }\n        }\n      }\n\n      return result.success\n    } catch (err) {\n      error.value = err instanceof Error ? err.message : 'Failed to save plan template config'\n      console.error('Failed to save plan template config:', err)\n      return false\n    } finally {\n      isLoading.value = false\n    }\n  }\n\n  // Validation\n  const validate = (): { isValid: boolean; errors: string[] } => {\n    const errors: string[] = []\n\n    if (!config.planTemplateId?.trim()) {\n      errors.push('Plan template ID is required')\n    }\n\n    if (!config.title?.trim()) {\n      errors.push('Title is required')\n    }\n\n    if (!config.steps || config.steps.length === 0) {\n      errors.push('At least one step is required')\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n    }\n  }\n\n  // Computed properties (isValid and hasToolConfig are not used)\n\n  // Utility function to parse date from different formats\n  const parseDateTime = (dateValue: unknown): Date => {\n    if (!dateValue) {\n      return new Date()\n    }\n\n    // If array format [year, month, day, hour, minute, second, nanosecond]\n    if (Array.isArray(dateValue) && dateValue.length >= 6) {\n      // JavaScript Date constructor months start from 0, so subtract 1\n      return new Date(\n        dateValue[0],\n        dateValue[1] - 1,\n        dateValue[2],\n        dateValue[3],\n        dateValue[4],\n        dateValue[5],\n        Math.floor(dateValue[6] / 1000000)\n      )\n    }\n\n    // If string format, parse directly\n    if (typeof dateValue === 'string') {\n      return new Date(dateValue)\n    }\n\n    // Return current time for other cases\n    return new Date()\n  }\n\n  // Action handlers (handleRollback, handleRestore, handleSave are not used)\n\n  /**\n   * Get all coordinator tools from planTemplateList\n   * Filters templates that have toolConfig with enableInternalToolcall enabled\n   * @returns Array of coordinator tools with tool configuration data\n   */\n  const getAllCoordinatorToolsFromTemplates = () => {\n    const tools: Array<{\n      toolName: string\n      toolDescription: string\n      planTemplateId: string\n      inputSchema: string\n      enableInternalToolcall: boolean\n      enableHttpService: boolean\n      enableInConversation: boolean\n      serviceGroup?: string\n    }> = []\n\n    for (const template of planTemplateList.value) {\n      // Only include templates with toolConfig\n      if (!template.toolConfig) {\n        continue\n      }\n\n      const toolConfig = template.toolConfig\n\n      // Only include tools with enableInternalToolcall enabled\n      if (!toolConfig.enableInternalToolcall) {\n        continue\n      }\n\n      // Convert inputSchema array to JSON string\n      let inputSchemaJson = '[]'\n      if (toolConfig.inputSchema && Array.isArray(toolConfig.inputSchema)) {\n        inputSchemaJson = JSON.stringify(toolConfig.inputSchema)\n      }\n\n      const tool: {\n        toolName: string\n        toolDescription: string\n        planTemplateId: string\n        inputSchema: string\n        enableInternalToolcall: boolean\n        enableHttpService: boolean\n        enableInConversation: boolean\n        serviceGroup?: string\n      } = {\n        toolName: template.title || '',\n        toolDescription: toolConfig.toolDescription || '',\n        planTemplateId: template.planTemplateId || '',\n        inputSchema: inputSchemaJson,\n        enableInternalToolcall: toolConfig.enableInternalToolcall ?? true,\n        enableHttpService: toolConfig.enableHttpService ?? false,\n        enableInConversation: toolConfig.enableInConversation ?? false,\n      }\n\n      if (template.serviceGroup) {\n        tool.serviceGroup = template.serviceGroup\n      }\n\n      tools.push(tool)\n    }\n\n    return tools\n  }\n\n  /**\n   * Get coordinator tool configuration status\n   * Determines if coordinator tools are enabled based on planTemplateList\n   * @returns boolean indicating if coordinator tools are enabled\n   */\n  const getCoordinatorToolConfig = (): boolean => {\n    // Check if there are any templates with toolConfig\n    return planTemplateList.value.some(template => template.toolConfig !== undefined)\n  }\n\n  // Helper method to wrap updates with guard flag\n  const withUpdateGuard = <T>(callback: () => T): T => {\n    isUserUpdating.value = true\n    try {\n      return callback()\n    } finally {\n      // Use setTimeout to ensure the flag is reset after reactivity updates\n      setTimeout(() => {\n        isUserUpdating.value = false\n      }, 0)\n    }\n  }\n\n  // Wrapped setters that prevent watcher syncing\n  const setStepsWithGuard = (steps: StepConfig[]) => {\n    return withUpdateGuard(() => {\n      setSteps(steps)\n    })\n  }\n\n  const setToolConfigWithGuard = (toolConfig: ToolConfigVO | undefined) => {\n    return withUpdateGuard(() => {\n      setToolConfig(toolConfig)\n    })\n  }\n\n  const setToolDescriptionWithGuard = (toolDescription: string) => {\n    return withUpdateGuard(() => {\n      setToolDescription(toolDescription)\n    })\n  }\n\n  const setEnableInternalToolcallWithGuard = (enable: boolean) => {\n    return withUpdateGuard(() => {\n      setEnableInternalToolcall(enable)\n    })\n  }\n\n  const setEnableHttpServiceWithGuard = (enable: boolean) => {\n    return withUpdateGuard(() => {\n      setEnableHttpService(enable)\n    })\n  }\n\n  const setEnableInConversationWithGuard = (enable: boolean) => {\n    return withUpdateGuard(() => {\n      setEnableInConversation(enable)\n    })\n  }\n\n  const setInputSchemaWithGuard = (inputSchema: InputSchemaParam[]) => {\n    return withUpdateGuard(() => {\n      setInputSchema(inputSchema)\n    })\n  }\n\n  return {\n    // State\n    config,\n    isLoading,\n    error,\n    isUserUpdating,\n    needsFullRefresh,\n    planVersions,\n    currentVersionIndex,\n    planTemplateList,\n    selectedTemplate,\n    currentPlanTemplateId,\n\n    // Getters\n    getTitle,\n    getPlanType,\n    getServiceGroup,\n    getConfig,\n\n    // Setters\n    setTitle,\n    setSteps,\n    setPlanType,\n    setPlanTemplateId,\n    setServiceGroup,\n    setToolConfig,\n    setToolDescription,\n    setEnableInternalToolcall,\n    setEnableHttpService,\n    setEnableInConversation,\n    setInputSchema,\n    setConfig,\n\n    // Guarded setters (prevent watcher syncing)\n    setStepsWithGuard,\n    setToolConfigWithGuard,\n    setToolDescriptionWithGuard,\n    setEnableInternalToolcallWithGuard,\n    setEnableHttpServiceWithGuard,\n    setEnableInConversationWithGuard,\n    setInputSchemaWithGuard,\n    withUpdateGuard,\n\n    // Actions\n    reset,\n    load,\n    save,\n    validate,\n    generateJsonString,\n    fromJsonString,\n    rollbackVersion,\n    restoreVersion,\n    updateVersionsAfterSave,\n\n    // Computed\n    canRollback,\n    canRestore,\n\n    // Utility functions\n    parseDateTime,\n\n    // Coordinator tools methods\n    getAllCoordinatorToolsFromTemplates,\n    getCoordinatorToolConfig,\n  }\n}\n\n// Singleton instance for global use\nlet singletonInstance: ReturnType<typeof usePlanTemplateConfig> | null = null\n\n/**\n * Get or create singleton instance of usePlanTemplateConfig\n */\nexport function usePlanTemplateConfigSingleton() {\n  if (!singletonInstance) {\n    singletonInstance = usePlanTemplateConfig()\n  }\n  return singletonInstance\n}\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PlanTemplateApiService } from '@/api/plan-template-with-tool-api-service'\nimport { i18n } from '@/base/i18n'\nimport { usePlanTemplateConfigSingleton } from '@/composables/usePlanTemplateConfig'\nimport type { PlanTemplateConfigVO } from '@/types/plan-template'\nimport { computed, reactive } from 'vue'\n\nexport class TemplateStore {\n  // Loading and error state\n  isLoading = false\n  errorMessage = ''\n  // Track task requirement modifications\n  hasTaskRequirementModified = false\n\n  // Organization method: 'by_time' | 'by_abc' | 'by_group_time' | 'by_group_abc'\n  organizationMethod: 'by_time' | 'by_abc' | 'by_group_time' | 'by_group_abc' = 'by_group_time'\n\n  // Template service group mapping (templateId -> serviceGroup)\n  templateServiceGroups: Map<string, string> = new Map()\n\n  // Group collapse state (groupName -> isCollapsed)\n  // Using plain object instead of Map for Vue reactivity\n  groupCollapseState: Record<string, boolean> = {}\n\n  constructor() {\n    // Load organization method from localStorage\n    const savedMethod = localStorage.getItem('sidebarOrganizationMethod')\n    if (\n      savedMethod &&\n      ['by_time', 'by_abc', 'by_group_time', 'by_group_abc'].includes(savedMethod)\n    ) {\n      this.organizationMethod = savedMethod as\n        | 'by_time'\n        | 'by_abc'\n        | 'by_group_time'\n        | 'by_group_abc'\n    }\n    // Load group collapse state from localStorage\n    this.loadGroupCollapseState()\n  }\n\n  // Load group collapse state from localStorage\n  loadGroupCollapseState() {\n    try {\n      const saved = localStorage.getItem('sidebarGroupCollapseState')\n      if (saved) {\n        const parsed = JSON.parse(saved)\n        this.groupCollapseState = parsed || {}\n      }\n    } catch (error) {\n      console.warn('[TemplateStore] Failed to load group collapse state:', error)\n    }\n  }\n\n  // Save group collapse state to localStorage\n  saveGroupCollapseState() {\n    try {\n      localStorage.setItem('sidebarGroupCollapseState', JSON.stringify(this.groupCollapseState))\n    } catch (error) {\n      console.warn('[TemplateStore] Failed to save group collapse state:', error)\n    }\n  }\n\n  // Toggle group collapse state\n  toggleGroupCollapse(groupName: string | null) {\n    // Convert null to string key for object property access\n    const key = groupName ?? 'null'\n    const currentState = this.groupCollapseState[key] ?? false\n    this.groupCollapseState[key] = !currentState\n    this.saveGroupCollapseState()\n  }\n\n  // Check if group is collapsed\n  isGroupCollapsed(groupName: string | null): boolean {\n    // Convert null to string key for object property access\n    const key = groupName ?? 'null'\n    return this.groupCollapseState[key] ?? false\n  }\n\n  // Helper function to parse date from different formats\n  parseDateTime(dateValue: unknown): Date {\n    if (!dateValue) {\n      return new Date()\n    }\n\n    // If array format [year, month, day, hour, minute, second, nanosecond]\n    if (Array.isArray(dateValue) && dateValue.length >= 6) {\n      // JavaScript Date constructor months start from 0, so subtract 1\n      return new Date(\n        dateValue[0],\n        dateValue[1] - 1,\n        dateValue[2],\n        dateValue[3],\n        dateValue[4],\n        dateValue[5],\n        Math.floor(dateValue[6] / 1000000)\n      )\n    }\n\n    // If string format, parse directly\n    if (typeof dateValue === 'string') {\n      return new Date(dateValue)\n    }\n\n    // Return current time for other cases\n    return new Date()\n  }\n\n  // Reference to template config for accessing planTemplateList\n  private templateConfig = usePlanTemplateConfigSingleton()\n\n  // Set organization method\n  setOrganizationMethod(method: 'by_time' | 'by_abc' | 'by_group_time' | 'by_group_abc') {\n    this.organizationMethod = method\n    localStorage.setItem('sidebarOrganizationMethod', method)\n  }\n\n  // Actions\n  async loadPlanTemplateList() {\n    this.isLoading = true\n    this.errorMessage = ''\n    try {\n      console.log('[TemplateStore] Starting to load plan template list...')\n      const configVOs = await PlanTemplateApiService.getAllPlanTemplateConfigVOs()\n\n      // Use PlanTemplateConfigVO directly\n      this.templateConfig.planTemplateList.value = configVOs\n\n      // Build service group mapping\n      this.templateServiceGroups.clear()\n      for (const config of this.templateConfig.planTemplateList.value) {\n        const planTemplateId = config.planTemplateId\n        if (planTemplateId) {\n          const serviceGroup = config.serviceGroup || ''\n          if (serviceGroup) {\n            this.templateServiceGroups.set(planTemplateId, serviceGroup)\n          }\n        }\n      }\n\n      console.log(\n        `[TemplateStore] Successfully loaded ${this.templateConfig.planTemplateList.value.length} plan templates`\n      )\n    } catch (error: unknown) {\n      console.error('[TemplateStore] Failed to load plan template list:', error)\n      this.templateConfig.planTemplateList.value = []\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      this.errorMessage = `Load failed: ${message}`\n    } finally {\n      this.isLoading = false\n    }\n  }\n\n  async selectTemplate(template: PlanTemplateConfigVO) {\n    this.templateConfig.currentPlanTemplateId.value = template.planTemplateId || null\n    this.templateConfig.selectedTemplate.value = template\n    // Reset modification flag when loading new template\n    this.hasTaskRequirementModified = false\n\n    console.log(`[TemplateStore] Selected plan template: ${template.planTemplateId}`)\n  }\n\n  async createNewTemplate(planType: string) {\n    try {\n      // Generate plan template ID from backend\n      const planTemplateId = await PlanTemplateApiService.generatePlanTemplateId()\n      console.log('[TemplateStore] Generated plan template ID from backend:', planTemplateId)\n\n      const emptyTemplate: PlanTemplateConfigVO = {\n        planTemplateId: planTemplateId,\n        title: i18n.global.t('sidebar.newTemplateName'),\n        planType: planType,\n        createTime: new Date().toISOString(),\n        updateTime: new Date().toISOString(),\n      }\n      this.templateConfig.selectedTemplate.value = emptyTemplate\n      this.templateConfig.currentPlanTemplateId.value = null\n\n      // Reset modification flag for new template\n      this.hasTaskRequirementModified = false\n\n      console.log('[TemplateStore] Created new empty plan template')\n    } catch (error) {\n      console.error('[TemplateStore] Failed to generate plan template ID:', error)\n      // Fallback to timestamp-based ID if backend call fails\n      const fallbackId = `planTemplate-${Date.now()}`\n      console.warn('[TemplateStore] Using fallback plan template ID:', fallbackId)\n      const emptyTemplate: PlanTemplateConfigVO = {\n        planTemplateId: fallbackId,\n        title: i18n.global.t('sidebar.newTemplateName'),\n        planType: planType,\n        createTime: new Date().toISOString(),\n        updateTime: new Date().toISOString(),\n      }\n      this.templateConfig.selectedTemplate.value = emptyTemplate\n      this.templateConfig.currentPlanTemplateId.value = null\n      this.hasTaskRequirementModified = false\n    }\n  }\n\n  async deleteTemplate(template: PlanTemplateConfigVO) {\n    const planTemplateId = template.planTemplateId\n    if (!planTemplateId) {\n      console.warn('[TemplateStore] deleteTemplate: Invalid template object or ID')\n      return\n    }\n    try {\n      await PlanTemplateApiService.deletePlanTemplate(planTemplateId)\n      if (this.templateConfig.currentPlanTemplateId.value === planTemplateId) {\n        this.clearSelection()\n      }\n      await this.loadPlanTemplateList()\n      console.log(`[TemplateStore] Plan template ${planTemplateId} has been deleted`)\n    } catch (error: unknown) {\n      console.error('Failed to delete plan template:', error)\n      await this.loadPlanTemplateList()\n      throw error\n    }\n  }\n\n  clearSelection() {\n    this.templateConfig.currentPlanTemplateId.value = null\n    this.templateConfig.selectedTemplate.value = null\n    this.hasTaskRequirementModified = false\n  }\n}\n\n// Create store instance\nconst storeInstance = new TemplateStore()\n\n// Get template config singleton for computed properties\nconst templateConfigRef = usePlanTemplateConfigSingleton()\n\n// Create reactive store first\nexport const templateStore = reactive({\n  // State properties\n  isLoading: storeInstance.isLoading,\n  errorMessage: storeInstance.errorMessage,\n  hasTaskRequirementModified: storeInstance.hasTaskRequirementModified,\n  organizationMethod: storeInstance.organizationMethod,\n  templateServiceGroups: storeInstance.templateServiceGroups,\n  groupCollapseState: storeInstance.groupCollapseState,\n\n  // Methods\n  loadGroupCollapseState: () => storeInstance.loadGroupCollapseState(),\n  saveGroupCollapseState: () => storeInstance.saveGroupCollapseState(),\n  toggleGroupCollapse: (groupName: string | null) => {\n    storeInstance.toggleGroupCollapse(groupName)\n    // Update reactive object - Vue can track object property changes directly\n    const key = groupName ?? 'null'\n    templateStore.groupCollapseState[key] = storeInstance.groupCollapseState[key]\n    // Force reactivity by creating new object reference\n    templateStore.groupCollapseState = { ...templateStore.groupCollapseState }\n  },\n  isGroupCollapsed: (groupName: string | null) => storeInstance.isGroupCollapsed(groupName),\n  parseDateTime: (dateValue: unknown) => storeInstance.parseDateTime(dateValue),\n  setOrganizationMethod: (method: 'by_time' | 'by_abc' | 'by_group_time' | 'by_group_abc') => {\n    storeInstance.setOrganizationMethod(method)\n    templateStore.organizationMethod = method\n  },\n  loadPlanTemplateList: async () => {\n    await storeInstance.loadPlanTemplateList()\n    // Update reactive properties after loading\n    templateStore.isLoading = storeInstance.isLoading\n    templateStore.errorMessage = storeInstance.errorMessage\n    templateStore.templateServiceGroups = storeInstance.templateServiceGroups\n  },\n  selectTemplate: (template: PlanTemplateConfigVO) => storeInstance.selectTemplate(template),\n  createNewTemplate: (planType: string) => storeInstance.createNewTemplate(planType),\n  deleteTemplate: (template: PlanTemplateConfigVO) => storeInstance.deleteTemplate(template),\n  clearSelection: () => storeInstance.clearSelection(),\n})\n\n// Create computed properties for reactive template lists\n// These must be defined after templateStore to access reactive properties\nconst sortedTemplatesComputed = computed(() => {\n  // Filter out readOnly templates (accessLevel === \"readOnly\")\n  const templates = [...templateConfigRef.planTemplateList.value].filter(template => {\n    const accessLevel = template.accessLevel || (template.readOnly ? 'readOnly' : 'editable')\n    return accessLevel !== 'readOnly'\n  })\n\n  switch (templateStore.organizationMethod) {\n    case 'by_time':\n      return templates.sort((a, b) => {\n        const timeA = templateStore.parseDateTime(a.updateTime ?? a.createTime)\n        const timeB = templateStore.parseDateTime(b.updateTime ?? b.createTime)\n        return timeB.getTime() - timeA.getTime()\n      })\n    case 'by_abc':\n      return templates.sort((a, b) => {\n        const titleA = (a.title ?? '').toLowerCase()\n        const titleB = (b.title ?? '').toLowerCase()\n        return titleA.localeCompare(titleB)\n      })\n    case 'by_group_time':\n    case 'by_group_abc': {\n      const groups = new Map<string, PlanTemplateConfigVO[]>()\n      const ungrouped: PlanTemplateConfigVO[] = []\n\n      templates.forEach(template => {\n        const planTemplateId = template.planTemplateId || ''\n        const serviceGroup = templateStore.templateServiceGroups.get(planTemplateId) ?? ''\n        if (!serviceGroup || serviceGroup === 'default' || serviceGroup === '') {\n          ungrouped.push(template)\n        } else {\n          if (!groups.has(serviceGroup)) {\n            groups.set(serviceGroup, [])\n          }\n          groups.get(serviceGroup)!.push(template)\n        }\n      })\n\n      const sortedGroups = new Map<string, PlanTemplateConfigVO[]>()\n      groups.forEach((templatesInGroup, groupName) => {\n        const sorted = [...templatesInGroup]\n        if (templateStore.organizationMethod === 'by_group_time') {\n          sorted.sort((a, b) => {\n            const timeA = templateStore.parseDateTime(a.updateTime ?? a.createTime)\n            const timeB = templateStore.parseDateTime(b.updateTime ?? b.createTime)\n            return timeB.getTime() - timeA.getTime()\n          })\n        } else {\n          sorted.sort((a, b) => {\n            const titleA = (a.title ?? '').toLowerCase()\n            const titleB = (b.title ?? '').toLowerCase()\n            return titleA.localeCompare(titleB)\n          })\n        }\n        sortedGroups.set(groupName, sorted)\n      })\n\n      if (templateStore.organizationMethod === 'by_group_time') {\n        ungrouped.sort((a, b) => {\n          const timeA = templateStore.parseDateTime(a.updateTime ?? a.createTime)\n          const timeB = templateStore.parseDateTime(b.updateTime ?? b.createTime)\n          return timeB.getTime() - timeA.getTime()\n        })\n      } else {\n        ungrouped.sort((a, b) => {\n          const titleA = (a.title ?? '').toLowerCase()\n          const titleB = (b.title ?? '').toLowerCase()\n          return titleA.localeCompare(titleB)\n        })\n      }\n\n      const result: PlanTemplateConfigVO[] = []\n      result.push(...ungrouped)\n      const sortedGroupNames = Array.from(sortedGroups.keys()).sort()\n      sortedGroupNames.forEach(groupName => {\n        result.push(...sortedGroups.get(groupName)!)\n      })\n      return result\n    }\n    default:\n      return templates.sort((a, b) => {\n        const timeA = templateStore.parseDateTime(a.updateTime || a.createTime || '')\n        const timeB = templateStore.parseDateTime(b.updateTime || b.createTime || '')\n        return timeB.getTime() - timeA.getTime()\n      })\n  }\n})\n\nconst groupedTemplatesComputed = computed(() => {\n  if (\n    templateStore.organizationMethod !== 'by_group_time' &&\n    templateStore.organizationMethod !== 'by_group_abc'\n  ) {\n    return new Map([[null, sortedTemplatesComputed.value]])\n  }\n\n  const groups = new Map<string | null, PlanTemplateConfigVO[]>()\n  const ungrouped: PlanTemplateConfigVO[] = []\n  const sorted = sortedTemplatesComputed.value\n\n  sorted.forEach(template => {\n    const planTemplateId = template.planTemplateId || ''\n    const serviceGroup = templateStore.templateServiceGroups.get(planTemplateId) ?? ''\n    if (!serviceGroup || serviceGroup === 'default' || serviceGroup === '') {\n      ungrouped.push(template)\n    } else {\n      if (!groups.has(serviceGroup)) {\n        groups.set(serviceGroup, [])\n      }\n      groups.get(serviceGroup)!.push(template)\n    }\n  })\n\n  const result = new Map<string | null, PlanTemplateConfigVO[]>()\n  if (ungrouped.length > 0) {\n    result.set(null, ungrouped)\n  }\n  const sortedGroupNames = Array.from(groups.keys()).sort()\n  sortedGroupNames.forEach(groupName => {\n    result.set(groupName, groups.get(groupName)!)\n  })\n\n  return result\n})\n\n// Add computed properties to reactive store using Object.defineProperty\nObject.defineProperty(templateStore, 'sortedTemplates', {\n  get: () => sortedTemplatesComputed.value,\n  enumerable: true,\n  configurable: true,\n})\n\nObject.defineProperty(templateStore, 'groupedTemplates', {\n  get: () => groupedTemplatesComputed.value,\n  enumerable: true,\n  configurable: true,\n})\n\n// Type augmentation to include computed properties\nexport interface TemplateStoreWithComputed {\n  sortedTemplates: PlanTemplateConfigVO[]\n  groupedTemplates: Map<string | null, PlanTemplateConfigVO[]>\n}\n\n// Type assertion to help TypeScript understand the computed properties\nexport type TemplateStoreType = typeof templateStore & TemplateStoreWithComputed\n"],"names":["MemoryStore","savedConversationId","error","conversationId","messages","memoryStore","reactive","DirectApiService","query","LlmCheckService","requestBody","response","requestSource","onChunk","errorText","reader","decoder","buffer","accumulatedMessage","done","value","lines","line","data","parsed","parseError","result","toolName","replacementParams","uploadedFiles","uploadKey","serviceGroup","planId","errorData","useTaskStop","taskStore","useTaskStore","isStopping","ref","canStop","computed","updateTaskState","targetPlanId","defineStore","currentTask","taskToInput","hasVisitedHome","prompt","newTask","task","stored","payload","stopTask","SidebarStore","tab","sidebarStore","PlanActApiService","rawParam","usePlanTemplateConfig","config","isLoading","isUserUpdating","needsFullRefresh","planVersions","currentVersionIndex","planTemplateList","selectedTemplate","currentPlanTemplateId","getTitle","getPlanType","getServiceGroup","setTitle","title","setSteps","steps","setPlanType","planType","setPlanTemplateId","planTemplateId","setServiceGroup","setToolConfig","toolConfig","setToolDescription","toolDescription","setEnableInternalToolcall","enable","setEnableHttpService","setEnableInConversation","setInputSchema","inputSchema","getConfig","setConfig","newConfig","accessLevel","updatedConfig","step","reset","generateJsonString","jsonConfig","fromJsonString","jsonString","err","canRollback","canRestore","rollbackVersion","versionContent","restoreVersion","updateVersionsAfterSave","content","load","loadedConfig","PlanTemplateApiService","resolve","versionsResponse","versionError","save","actualPlanTemplateId","oldPlanTemplateId","templateIndex","t","oldTemplateIndex","validate","errors","parseDateTime","dateValue","getAllCoordinatorToolsFromTemplates","tools","template","inputSchemaJson","tool","getCoordinatorToolConfig","withUpdateGuard","callback","singletonInstance","usePlanTemplateConfigSingleton","TemplateStore","savedMethod","saved","groupName","key","currentState","method","configVOs","message","emptyTemplate","i18n","fallbackId","storeInstance","templateConfigRef","templateStore","sortedTemplatesComputed","templates","a","b","timeA","titleA","titleB","groups","ungrouped","sortedGroups","templatesInGroup","sorted","groupedTemplatesComputed"],"mappings":"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"}