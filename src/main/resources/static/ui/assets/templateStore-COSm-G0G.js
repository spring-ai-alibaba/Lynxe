import{C as P,r as I,c as M,R as le,S as J}from"./index-C4A-fOFO.js";import{P as L}from"./plan-template-with-tool-api-service-Bn2E1HUq.js";import{L as G}from"./llm-check-CJy4TeZw.js";class re{isCollapsed=!1;conversationId=null;loadMessages=()=>{};intervalId=void 0;CONVERSATION_ID_KEY="currentConversationId";constructor(){this.loadConversationIdFromStorage()}loadConversationIdFromStorage(){try{const e=localStorage.getItem(this.CONVERSATION_ID_KEY);e&&(this.conversationId=e,console.log("[MemoryStore] Restored conversationId from localStorage:",e))}catch(e){console.warn("[MemoryStore] Failed to load conversationId from localStorage:",e)}}saveConversationIdToStorage(){try{this.conversationId?(localStorage.setItem(this.CONVERSATION_ID_KEY,this.conversationId),console.log("[MemoryStore] Saved conversationId to localStorage:",this.conversationId)):(localStorage.removeItem(this.CONVERSATION_ID_KEY),console.log("[MemoryStore] Removed conversationId from localStorage"))}catch(e){console.warn("[MemoryStore] Failed to save conversationId to localStorage:",e)}}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectConversation(e){this.toggleSidebar(),this.conversationId=e,this.saveConversationIdToStorage()}clearSelectedConversation(){this.conversationId=null,this.saveConversationIdToStorage()}setConversationId(e){this.conversationId=e,this.saveConversationIdToStorage()}clearConversationId(){this.conversationId=null,this.saveConversationIdToStorage()}getConversationId(){return this.conversationId}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const b=P(new re);class K{static BASE_URL="/api/executor";static async sendMessage(e){return G.withLlmCheck(async()=>{const a={...e,requestSource:"VUE_DIALOG"},s=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`API request failed: ${s.status}`);return await s.json()})}static async sendChatMessage(e,a="VUE_DIALOG",s){return G.withLlmCheck(async()=>{console.log("[DirectApiService] sendChatMessage called with:",{input:e.input,uploadedFiles:e.uploadedFiles,uploadKey:e.uploadKey,requestSource:a});const c={input:e.input,requestSource:a};b.conversationId&&(c.conversationId=b.conversationId,console.log("[DirectApiService] Including conversationId from memoryStore:",b.conversationId)),e.uploadedFiles&&e.uploadedFiles.length>0&&(c.uploadedFiles=e.uploadedFiles,console.log("[DirectApiService] Including uploaded files:",e.uploadedFiles.length)),e.uploadKey&&(c.uploadKey=e.uploadKey,console.log("[DirectApiService] Including uploadKey:",e.uploadKey)),console.log("[DirectApiService] Making SSE request to:",`${this.BASE_URL}/chat`),console.log("[DirectApiService] Request body:",c);const l=await fetch(`${this.BASE_URL}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(c)});if(console.log("[DirectApiService] Response status:",l.status,l.ok),console.log("[DirectApiService] Response headers:",{contentType:l.headers.get("Content-Type"),transferEncoding:l.headers.get("Transfer-Encoding")}),!l.ok){const C=await l.text();throw console.error("[DirectApiService] Request failed:",C),new Error(`Failed to send chat message: ${l.status}`)}if(!l.body)throw new Error("Response body is null");const n=l.body.getReader(),r=new TextDecoder;let i="",g,h="";console.log("[DirectApiService] Starting to read SSE stream...");try{for(;;){const{done:C,value:D}=await n.read();if(console.log("[DirectApiService] Read chunk:",{done:C,valueLength:D?.length}),C)break;i+=r.decode(D,{stream:!0}),console.log("[DirectApiService] Buffer length:",i.length,"content:",i.substring(0,200));const A=i.split(`

`);i=A.pop()||"",console.log("[DirectApiService] Split into",A.length,"lines, buffer remaining:",i.length);for(const k of A)if(console.log("[DirectApiService] Processing line:",k),k.startsWith("data:")){const u=k.startsWith("data: ")?k.slice(6):k.slice(5);console.log("[DirectApiService] Extracted data:",u);try{const T=JSON.parse(u);if(console.log("[DirectApiService] Parsed SSE event:",T),T.type==="start"&&T.conversationId)g=T.conversationId,console.log("[DirectApiService] Got start event with conversationId:",g),s&&s({type:"start",conversationId:T.conversationId});else if(T.type==="chunk"&&T.content)h+=T.content,console.log("[DirectApiService] Got chunk, accumulated length:",h.length),s&&s({type:"chunk",content:T.content});else if(T.type==="done")console.log("[DirectApiService] Got done event"),s&&s({type:"done"});else if(T.type==="error")throw console.error("[DirectApiService] Got error event:",T.message),s&&s({type:"error",message:T.message||"Streaming error occurred"}),n.releaseLock(),new Error(T.message||"Streaming error occurred")}catch(T){console.error("[DirectApiService] Error parsing SSE data:",T,"Data:",u)}}}}finally{n.releaseLock()}const y={};return g&&(y.conversationId=g),y.message=h||"No response received",console.log("[DirectApiService] sendChatMessage completed:",y),y})}static async executeByToolName(e,a,s,c,l="VUE_DIALOG",n){return G.withLlmCheck(async()=>{console.log("[DirectApiService] executeByToolName called with:",{toolName:e,replacementParams:a,uploadedFiles:s,uploadKey:c,requestSource:l,serviceGroup:n});const r={toolName:e,requestSource:l};b.conversationId&&(r.conversationId=b.conversationId,console.log("[DirectApiService] Including conversationId from memoryStore:",b.conversationId)),n&&(r.serviceGroup=n,console.log("[DirectApiService] Including serviceGroup:",n)),a&&Object.keys(a).length>0&&(r.replacementParams=a,console.log("[DirectApiService] Including replacement params:",a)),s&&s.length>0&&(r.uploadedFiles=s,console.log("[DirectApiService] Including uploaded files:",s.length)),c&&(r.uploadKey=c,console.log("[DirectApiService] Including uploadKey:",c)),console.log("[DirectApiService] Making request to:",`${this.BASE_URL}/executeByToolNameAsync`),console.log("[DirectApiService] Request body:",r);const i=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(console.log("[DirectApiService] Response status:",i.status,i.ok),!i.ok){const h=await i.text();throw console.error("[DirectApiService] Request failed:",h),new Error(`Failed to execute: ${i.status}`)}const g=await i.json();return console.log("[DirectApiService] executeByToolName response:",g),g})}static async stopTask(e){return G.withLlmCheck(async()=>{console.log("[DirectApiService] Stopping task for planId:",e);const a=await fetch(`${this.BASE_URL}/stopTask/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.error||`Failed to stop task: ${a.status}`)}return await a.json()})}}function ie(){const t=ce(),e=I(!1),a=M(()=>t.hasRunningTask()&&!!t.currentTask?.planId);return{stopTask:async(c,l=!0)=>{const n=c||t.currentTask?.planId;if(!n)return console.warn("[useTaskStop] No planId available to stop"),!1;if(e.value)return console.log("[useTaskStop] Stop already in progress, skipping"),!1;console.log("[useTaskStop] Stopping task for planId:",n),e.value=!0;try{return await K.stopTask(n),console.log("[useTaskStop] Task stopped successfully"),l&&t.currentTask&&t.currentTask.planId===n&&(t.currentTask.isRunning=!1),!0}catch(r){return console.error("[useTaskStop] Failed to stop task:",r),!1}finally{e.value=!1}},isStopping:e,canStop:a}}const ce=le("task",()=>{const t=I(null),e=I(""),a=I(!1);return{currentTask:t,taskToInput:e,hasVisitedHome:a,setTask:u=>{if(console.log("[TaskStore] setTask called with prompt:",u),!u.trim()){console.warn("[TaskStore] Empty prompt provided, not creating task");return}const T={prompt:u,timestamp:Date.now(),processed:!1};t.value=T,console.log("[TaskStore] Task set, currentTask.value:",t.value)},setTaskToInput:u=>{console.log("[TaskStore] setTaskToInput called with prompt:",u),e.value=u,console.log("[TaskStore] Task to input set:",e.value)},getAndClearTaskToInput:()=>{const u=e.value;return e.value="",console.log("[TaskStore] getAndClearTaskToInput returning:",u),u},markTaskAsProcessed:()=>{console.log("[TaskStore] markTaskAsProcessed called, current task:",t.value),t.value?(t.value.processed=!0,console.log("[TaskStore] Task marked as processed:",t.value)):console.log("[TaskStore] No current task to mark as processed")},clearTask:()=>{t.value=null},hasUnprocessedTask:()=>{const u=t.value&&!t.value.processed;return console.log("[TaskStore] hasUnprocessedTask check - currentTask:",t.value,"result:",u),u},markHomeVisited:()=>{a.value=!0,localStorage.setItem("hasVisitedHome","true")},checkHomeVisited:()=>{const u=localStorage.getItem("hasVisitedHome");return a.value=u==="true",a.value},resetHomeVisited:()=>{a.value=!1,localStorage.removeItem("hasVisitedHome")},emitPlanExecutionRequested:u=>{console.log("[TaskStore] emitPlanExecutionRequested called with payload:",u),window.dispatchEvent(new CustomEvent("plan-execution-requested",{detail:u}))},setTaskRunning:u=>{console.log("[TaskStore] setTaskRunning called with planId:",u),t.value?(t.value.planId=u,t.value.isRunning=!0,console.log("[TaskStore] Updated existing task:",t.value)):(t.value={prompt:"",timestamp:Date.now(),processed:!1,planId:u,isRunning:!0},console.log("[TaskStore] Created new task for running state:",t.value))},stopCurrentTask:async()=>{if(console.log("[TaskStore] stopCurrentTask called"),t.value&&t.value.isRunning&&t.value.planId){const{stopTask:u}=ie();return await u(t.value.planId,!0)}return!1},hasRunningTask:()=>{const u=t.value&&t.value.isRunning;return console.log("[TaskStore] hasRunningTask check - result:",u),u}}});class pe{isCollapsed=!1;currentTab="list";toggleSidebar(){this.isCollapsed=!this.isCollapsed}switchToTab(e){this.currentTab=e}}const be=P(new pe);class ue{static PLAN_TEMPLATE_URL="/api/plan-template";static async executePlan(e,a,s,c,l,n,r="VUE_SIDEBAR"){return G.withLlmCheck(async()=>(console.log("[PlanActApiService] executePlan called with:",{toolName:e,serviceGroup:a,rawParam:s,uploadedFiles:c,replacementParams:l,uploadKey:n,requestSource:r}),s&&(l||(l={}),l.userRequirement=s,console.log("[PlanActApiService] Added rawParam to replacementParams:",s)),await K.executeByToolName(e,l,c,n,r,a)))}static async getPlanVersions(e){const a=await fetch(`${this.PLAN_TEMPLATE_URL}/versions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:e})});if(!a.ok)throw new Error(`Failed to get plan versions: ${a.status}`);return await a.json()}static async getAllPlanTemplates(){const e=await fetch(`${this.PLAN_TEMPLATE_URL}/list`);if(!e.ok)throw new Error(`Failed to get plan template list: ${e.status}`);return await e.json()}}function de(){const t=P({title:"",steps:[],planType:"dynamic_agent",planTemplateId:"",accessLevel:"editable",serviceGroup:""}),e=I(!1),a=I(null),s=I(!1),c=I(!1),l=I([]),n=I(-1),r=I([]),i=I(null),g=I(null),h=()=>t.title,y=()=>t.planType||"dynamic_agent",C=()=>t.serviceGroup||"",D=o=>{t.title=o},A=o=>{t.steps=o||[]},k=o=>{t.planType=o},u=o=>{t.planTemplateId=o},T=o=>{t.serviceGroup=o},B=o=>{o===void 0?delete t.toolConfig:t.toolConfig=o},F=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.toolDescription=o},U=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.enableInternalToolcall=o},$=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.enableHttpService=o},j=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.enableInConversation=o},W=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.inputSchema=o||[]},E=()=>({...t}),R=o=>{c.value=!0;const p=o.accessLevel||(o.readOnly?"readOnly":"editable"),m={title:o.title||"",steps:(o.steps||[]).map(f=>({...f,selectedToolKeys:f.selectedToolKeys??[]})),planType:o.planType||"dynamic_agent",planTemplateId:o.planTemplateId||"",accessLevel:p,serviceGroup:o.serviceGroup||""};o.toolConfig&&(m.toolConfig={...o.toolConfig}),Object.assign(t,m),setTimeout(()=>{c.value=!1},50)},Y=()=>{c.value=!0,Object.assign(t,{title:"",steps:[],planType:"dynamic_agent",planTemplateId:"",accessLevel:"editable",serviceGroup:""}),"toolConfig"in t&&delete t.toolConfig,l.value=[],n.value=-1,a.value=null,setTimeout(()=>{c.value=!1},0)},Q=()=>{const o=t.accessLevel||(t.readOnly?"readOnly":"editable"),p={title:t.title||"",steps:(t.steps||[]).map(m=>({...m,selectedToolKeys:m.selectedToolKeys??[]})),planType:t.planType||"dynamic_agent",planTemplateId:t.planTemplateId||"",accessLevel:o,serviceGroup:t.serviceGroup||""};return t.toolConfig&&(p.toolConfig={...t.toolConfig}),JSON.stringify(p,null,2)},O=o=>{try{const p=JSON.parse(o);return R(p),!0}catch(p){return a.value=p instanceof Error?p.message:"Invalid JSON format",!1}},z=M(()=>l.value.length>1&&n.value>0),H=M(()=>l.value.length>1&&n.value<l.value.length-1),X=()=>{if(z.value&&n.value>0){n.value--;const o=l.value[n.value]||"";O(o)}},Z=()=>{if(H.value&&n.value<l.value.length-1){n.value++;const o=l.value[n.value]||"";O(o)}},ee=o=>{n.value<l.value.length-1&&(l.value=l.value.slice(0,n.value+1)),l.value.push(o),n.value=l.value.length-1},q=async o=>{if(!o)return a.value="Plan template ID is required",!1;try{e.value=!0,a.value=null;const p=await L.getPlanTemplateConfigVO(o);g.value===o&&(g.value=null,await new Promise(f=>setTimeout(f,0))),s.value=!1,R(p),g.value=o,await new Promise(f=>setTimeout(f,10)),i.value?.planTemplateId===o&&(i.value={...i.value,...p});try{const f=await ue.getPlanVersions(o);l.value=f.versions||[],l.value.length>0?n.value=l.value.length-1:n.value=-1}catch(f){console.warn("Failed to load plan versions:",f),l.value=[],n.value=-1}return!0}catch(p){return a.value=p instanceof Error?p.message:"Failed to load plan template config",console.error("Failed to load plan template config:",p),!1}finally{e.value=!1}},te=async()=>{if(!t.planTemplateId)return a.value="Plan template ID is required",!1;try{e.value=!0,a.value=null;const o=await L.createOrUpdatePlanTemplateWithTool(E());if(o.success){const p=o.planTemplateId||t.planTemplateId;if(p&&p!==t.planTemplateId&&(console.log("[usePlanTemplateConfig] PlanTemplateId replaced by backend:",t.planTemplateId,"->",p),t.planTemplateId=p),p){await q(p);const m=i.value?.planTemplateId;if(m===p||m===t.planTemplateId){const S=E();i.value={...i.value,...S,planTemplateId:p}}const f=r.value.findIndex(S=>S.planTemplateId===p||S.planTemplateId===m);if(f>=0){const S=E();r.value[f]={...r.value[f],...S,planTemplateId:p}}else if(m){const S=r.value.findIndex(_=>_.planTemplateId===m);if(S>=0){const _=E();r.value[S]={...r.value[S],..._,planTemplateId:p}}}}}return o.success}catch(o){return a.value=o instanceof Error?o.message:"Failed to save plan template config",console.error("Failed to save plan template config:",o),!1}finally{e.value=!1}},oe=()=>{const o=[];return t.planTemplateId?.trim()||o.push("Plan template ID is required"),t.title?.trim()||o.push("Title is required"),(!t.steps||t.steps.length===0)&&o.push("At least one step is required"),{isValid:o.length===0,errors:o}},ae=o=>o?Array.isArray(o)&&o.length>=6?new Date(o[0],o[1]-1,o[2],o[3],o[4],o[5],Math.floor(o[6]/1e6)):typeof o=="string"?new Date(o):new Date:new Date,se=()=>{const o=[];for(const p of r.value){if(!p.toolConfig)continue;const m=p.toolConfig;if(!m.enableInternalToolcall)continue;let f="[]";m.inputSchema&&Array.isArray(m.inputSchema)&&(f=JSON.stringify(m.inputSchema));const S={toolName:p.title||"",toolDescription:m.toolDescription||"",planTemplateId:p.planTemplateId||"",inputSchema:f,enableInternalToolcall:m.enableInternalToolcall??!0,enableHttpService:m.enableHttpService??!1,enableInConversation:m.enableInConversation??!1};p.serviceGroup&&(S.serviceGroup=p.serviceGroup),o.push(S)}return o},ne=()=>r.value.some(o=>o.toolConfig!==void 0),w=o=>{s.value=!0;try{return o()}finally{setTimeout(()=>{s.value=!1},0)}};return{config:t,isLoading:e,error:a,isUserUpdating:s,needsFullRefresh:c,planVersions:l,currentVersionIndex:n,planTemplateList:r,selectedTemplate:i,currentPlanTemplateId:g,getTitle:h,getPlanType:y,getServiceGroup:C,getConfig:E,setTitle:D,setSteps:A,setPlanType:k,setPlanTemplateId:u,setServiceGroup:T,setToolConfig:B,setToolDescription:F,setEnableInternalToolcall:U,setEnableHttpService:$,setEnableInConversation:j,setInputSchema:W,setConfig:R,setStepsWithGuard:o=>w(()=>{A(o)}),setToolConfigWithGuard:o=>w(()=>{B(o)}),setToolDescriptionWithGuard:o=>w(()=>{F(o)}),setEnableInternalToolcallWithGuard:o=>w(()=>{U(o)}),setEnableHttpServiceWithGuard:o=>w(()=>{$(o)}),setEnableInConversationWithGuard:o=>w(()=>{j(o)}),setInputSchemaWithGuard:o=>w(()=>{W(o)}),withUpdateGuard:w,reset:Y,load:q,save:te,validate:oe,generateJsonString:Q,fromJsonString:O,rollbackVersion:X,restoreVersion:Z,updateVersionsAfterSave:ee,canRollback:z,canRestore:H,parseDateTime:ae,getAllCoordinatorToolsFromTemplates:se,getCoordinatorToolConfig:ne}}let N=null;function V(){return N||(N=de()),N}class ge{isLoading=!1;errorMessage="";hasTaskRequirementModified=!1;organizationMethod="by_group_time";templateServiceGroups=new Map;groupCollapseState={};constructor(){const e=localStorage.getItem("sidebarOrganizationMethod");e&&["by_time","by_abc","by_group_time","by_group_abc"].includes(e)&&(this.organizationMethod=e),this.loadGroupCollapseState()}loadGroupCollapseState(){try{const e=localStorage.getItem("sidebarGroupCollapseState");if(e){const a=JSON.parse(e);this.groupCollapseState=a||{}}}catch(e){console.warn("[TemplateStore] Failed to load group collapse state:",e)}}saveGroupCollapseState(){try{localStorage.setItem("sidebarGroupCollapseState",JSON.stringify(this.groupCollapseState))}catch(e){console.warn("[TemplateStore] Failed to save group collapse state:",e)}}toggleGroupCollapse(e){const a=e??"null",s=this.groupCollapseState[a]??!1;this.groupCollapseState[a]=!s,this.saveGroupCollapseState()}isGroupCollapsed(e){const a=e??"null";return this.groupCollapseState[a]??!1}parseDateTime(e){return e?Array.isArray(e)&&e.length>=6?new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5],Math.floor(e[6]/1e6)):typeof e=="string"?new Date(e):new Date:new Date}templateConfig=V();setOrganizationMethod(e){this.organizationMethod=e,localStorage.setItem("sidebarOrganizationMethod",e)}async loadPlanTemplateList(){this.isLoading=!0,this.errorMessage="";try{console.log("[TemplateStore] Starting to load plan template list...");const e=await L.getAllPlanTemplateConfigVOs();this.templateConfig.planTemplateList.value=e,this.templateServiceGroups.clear();for(const a of this.templateConfig.planTemplateList.value){const s=a.planTemplateId;if(s){const c=a.serviceGroup||"";c&&this.templateServiceGroups.set(s,c)}}console.log(`[TemplateStore] Successfully loaded ${this.templateConfig.planTemplateList.value.length} plan templates`)}catch(e){console.error("[TemplateStore] Failed to load plan template list:",e),this.templateConfig.planTemplateList.value=[];const a=e instanceof Error?e.message:"Unknown error";this.errorMessage=`Load failed: ${a}`}finally{this.isLoading=!1}}async selectTemplate(e){this.templateConfig.currentPlanTemplateId.value=e.planTemplateId||null,this.templateConfig.selectedTemplate.value=e,this.hasTaskRequirementModified=!1,console.log(`[TemplateStore] Selected plan template: ${e.planTemplateId}`)}async createNewTemplate(e){try{const a=await L.generatePlanTemplateId();console.log("[TemplateStore] Generated plan template ID from backend:",a);const s={planTemplateId:a,title:J.global.t("sidebar.newTemplateName"),planType:e,createTime:new Date().toISOString(),updateTime:new Date().toISOString()};this.templateConfig.selectedTemplate.value=s,this.templateConfig.currentPlanTemplateId.value=null,this.hasTaskRequirementModified=!1,console.log("[TemplateStore] Created new empty plan template")}catch(a){console.error("[TemplateStore] Failed to generate plan template ID:",a);const s=`planTemplate-${Date.now()}`;console.warn("[TemplateStore] Using fallback plan template ID:",s);const c={planTemplateId:s,title:J.global.t("sidebar.newTemplateName"),planType:e,createTime:new Date().toISOString(),updateTime:new Date().toISOString()};this.templateConfig.selectedTemplate.value=c,this.templateConfig.currentPlanTemplateId.value=null,this.hasTaskRequirementModified=!1}}async deleteTemplate(e){const a=e.planTemplateId;if(!a){console.warn("[TemplateStore] deleteTemplate: Invalid template object or ID");return}try{await L.deletePlanTemplate(a),this.templateConfig.currentPlanTemplateId.value===a&&this.clearSelection(),await this.loadPlanTemplateList(),console.log(`[TemplateStore] Plan template ${a} has been deleted`)}catch(s){throw console.error("Failed to delete plan template:",s),await this.loadPlanTemplateList(),s}}clearSelection(){this.templateConfig.currentPlanTemplateId.value=null,this.templateConfig.selectedTemplate.value=null,this.hasTaskRequirementModified=!1}}const v=new ge,me=V(),d=P({isLoading:v.isLoading,errorMessage:v.errorMessage,hasTaskRequirementModified:v.hasTaskRequirementModified,organizationMethod:v.organizationMethod,templateServiceGroups:v.templateServiceGroups,groupCollapseState:v.groupCollapseState,loadGroupCollapseState:()=>v.loadGroupCollapseState(),saveGroupCollapseState:()=>v.saveGroupCollapseState(),toggleGroupCollapse:t=>{v.toggleGroupCollapse(t);const e=t??"null";d.groupCollapseState[e]=v.groupCollapseState[e],d.groupCollapseState={...d.groupCollapseState}},isGroupCollapsed:t=>v.isGroupCollapsed(t),parseDateTime:t=>v.parseDateTime(t),setOrganizationMethod:t=>{v.setOrganizationMethod(t),d.organizationMethod=t},loadPlanTemplateList:async()=>{await v.loadPlanTemplateList(),d.isLoading=v.isLoading,d.errorMessage=v.errorMessage,d.templateServiceGroups=v.templateServiceGroups},selectTemplate:t=>v.selectTemplate(t),createNewTemplate:t=>v.createNewTemplate(t),deleteTemplate:t=>v.deleteTemplate(t),clearSelection:()=>v.clearSelection()}),x=M(()=>{const t=[...me.planTemplateList.value].filter(e=>(e.accessLevel||(e.readOnly?"readOnly":"editable"))!=="readOnly");switch(d.organizationMethod){case"by_time":return t.sort((e,a)=>{const s=d.parseDateTime(e.updateTime??e.createTime);return d.parseDateTime(a.updateTime??a.createTime).getTime()-s.getTime()});case"by_abc":return t.sort((e,a)=>{const s=(e.title??"").toLowerCase(),c=(a.title??"").toLowerCase();return s.localeCompare(c)});case"by_group_time":case"by_group_abc":{const e=new Map,a=[];t.forEach(n=>{const r=n.planTemplateId||"",i=d.templateServiceGroups.get(r)??"";!i||i==="default"||i===""?a.push(n):(e.has(i)||e.set(i,[]),e.get(i).push(n))});const s=new Map;e.forEach((n,r)=>{const i=[...n];d.organizationMethod==="by_group_time"?i.sort((g,h)=>{const y=d.parseDateTime(g.updateTime??g.createTime);return d.parseDateTime(h.updateTime??h.createTime).getTime()-y.getTime()}):i.sort((g,h)=>{const y=(g.title??"").toLowerCase(),C=(h.title??"").toLowerCase();return y.localeCompare(C)}),s.set(r,i)}),d.organizationMethod==="by_group_time"?a.sort((n,r)=>{const i=d.parseDateTime(n.updateTime??n.createTime);return d.parseDateTime(r.updateTime??r.createTime).getTime()-i.getTime()}):a.sort((n,r)=>{const i=(n.title??"").toLowerCase(),g=(r.title??"").toLowerCase();return i.localeCompare(g)});const c=[];return c.push(...a),Array.from(s.keys()).sort().forEach(n=>{c.push(...s.get(n))}),c}default:return t.sort((e,a)=>{const s=d.parseDateTime(e.updateTime||e.createTime||"");return d.parseDateTime(a.updateTime||a.createTime||"").getTime()-s.getTime()})}}),ve=M(()=>{if(d.organizationMethod!=="by_group_time"&&d.organizationMethod!=="by_group_abc")return new Map([[null,x.value]]);const t=new Map,e=[];x.value.forEach(l=>{const n=l.planTemplateId||"",r=d.templateServiceGroups.get(n)??"";!r||r==="default"||r===""?e.push(l):(t.has(r)||t.set(r,[]),t.get(r).push(l))});const s=new Map;return e.length>0&&s.set(null,e),Array.from(t.keys()).sort().forEach(l=>{s.set(l,t.get(l))}),s});Object.defineProperty(d,"sortedTemplates",{get:()=>x.value,enumerable:!0,configurable:!0});Object.defineProperty(d,"groupedTemplates",{get:()=>ve.value,enumerable:!0,configurable:!0});export{K as D,ue as P,V as a,ie as b,b as m,be as s,d as t,ce as u};
//# sourceMappingURL=templateStore-COSm-G0G.js.map
